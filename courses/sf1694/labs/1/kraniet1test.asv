clear all;
format long;
start_nodUpper = [0;1];
start_nodLower = [0; 0.8];
slut_nod = [1; 0.5];
antal_noder = 10;
d = 0.2; %avst√•ndet mellan startnoderna

function ret = skapaFackverk(start_nodUpper, start_nodLower, slut_nod, antal_noder, d)
    antal_noderUpper = ceil(antal_noder/2);
    antal_noderLower = floor(antal_noder/2);

    is_slut_nod_upper = mod(antal_noder,2) == 1;
    Noder_Lower = start_nodLower;
    Noder_Upper = start_nodUpper;
    Noder = [;];


        if is_slut_nod_upper
           balk_length_b = norm(slut_nod-start_nodUpper)/antal_noderUpper;
           kranvinkel = atan((slut_nod(2)-start_nodUpper(2))/(slut_nod(1)-start_nodUpper(1)));
        else
           balk_length_b = norm(slut_nod-start_nodLower)/antal_noderLower;
        end


        if (is_slut_nod_upper)

        else
            kranvinkel = atan((slut_nod(1)-start_nodLower(1))/(slut_nod(2)-start_nodLower(2)));
        end
        
        c = d*cos(kranvinkel);
        balk_length_a = sqrt(power(d, 2) + power(balk_length_b/2, 2));

      
        theta = atan(balk_length_b/(2*d));


        %lutning = (slut_nod(2)-start_nodLower(2))/(slut_nod(1)-start_nodLower(1));
        if is_slut_nod_upper
            delta_x = (slut_nod(1)-start_nodUpper(1))/antal_noderUpper;
            delta_y = (slut_nod(2)-start_nodUpper(2))/antal_noderUpper;
        else
            delta_x = (slut_nod(1)-start_nodLower(1))/antal_noderLower;
            delta_y = (slut_nod(2)-start_nodLower(2))/antal_noderLower;
        end

        disp("slask")
        
        if is_slut_nod_upper
            x0 = start_nodUpper(1);
            y0 = start_nodUpper(2);
            for i = 1:antal_noderUpper
                x1 = x0 + delta_x;
                x0 = x1;
            
                y1 = y0 + delta_y;
                y0 = y1;
            
                Noder_Upper(1,end+1) = x1;
                Noder_Upper(2,end) = y1;
            end
        else
            x0 = start_nodLower(1);
            y0 = start_nodLower(2);
            for i = 1:antal_noderLower
                x1 = x0 + delta_x;
                x0 = x1;
            
                y1 = y0 + delta_y;
                y0 = y1;
            
                Noder_Lower(1,end+1) = x1;
                Noder_Lower(2,end) = y1;
            end
        
        end

        if is_slut_nod_upper
            v = pi - (kranvinkel + theta);
            delta_x = balk_length_a.*sin(v);
            delta_y = balk_length_a.*cos(v);
        else
            v = -1*(abs(theta) + kranvinkel);
            delta_x = balk_length_a*sin(v);
            delta_y = balk_length_a*cos(v);
        end


        if is_slut_nod_upper
            for i = 1:(antal_noderUpper-1)
                ny_nod_x = Noder_Upper(1, i+1) + delta_x;
                ny_nod_y = Noder_Upper(2, i+1) + delta_y;
                Noder_Lower(1, end+1) = ny_nod_x;
                Noder_Lower(2, end) = ny_nod_y;
            end

            for i = 1:(antal_noderUpper)
                Noder(1, end+1) = Noder_Lower(1, i);
                Noder(2, end) = Noder_Lower(2, i);
                Noder(1, end+1) = Noder_Upper(1, i);
                Noder(2, end) = Noder_Upper(2, i);
            end
            Noder(1, end+1) = Noder_Upper(1, end);
            Noder(2, end) = Noder_Upper(2, end);
        else
            for i = 1:(antal_noderLower)
                ny_nod_x = Noder_Lower(1, i) + delta_x;
                ny_nod_y = Noder_Lower(2, i) + delta_y;
                Noder_Upper(1, end+1) = ny_nod_x;
                Noder_Upper(2, end) = ny_nod_y;
            end

            for i = 1:(antal_noderLower+1)
                Noder(1, end+1) = Noder_Upper(1, i);
                Noder(2, end) = Noder_Upper(2, i);
                Noder(1, end+1) = Noder_Lower(1, i);
                Noder(2, end) = Noder_Lower(2, i);
            end

            Noder(1, end+1) = Noder_Lower(1, end);
            Noder(2, end) = Noder_Lower(2, end);
        end

        Noder_Lower
        Noder_Upper
        disp(Noder)

    
    ret = Noder;
    
end

Noder = skapaFackverk(start_nodUpper, start_nodLower, slut_nod, antal_noder, d);
plot(Noder(1, :), Noder(2, :), "*")
hold on;
axis equal;
hold off;


